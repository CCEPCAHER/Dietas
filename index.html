<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAIKA PORCUNA - Plan de Alimentación Personalizada</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Aplicación profesional para la creación de planes de alimentación personalizados - Nutrición, Dietética, Suplementación y Nutrición Deportiva">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="MAIKA PORCUNA">
    <meta name="mobile-web-app-capable" content="yes">
    
    <!-- Manifest y Iconos -->
    <link rel="manifest" href="/manifest.json?v=3">
    
    <!-- Favicon e iconos Apple -->
    <link rel="shortcut icon" href="/icon-192x192.png?v=3">
    <link rel="icon" type="image/png" sizes="192x192" href="/icon-192x192.png?v=3">
    <link rel="icon" type="image/png" sizes="512x512" href="/icon-512x512.png?v=3">
    <link rel="apple-touch-icon" href="/icon-180x180.png?v=3">
    <link rel="apple-touch-icon" sizes="180x180" href="/icon-180x180.png?v=3">
    <link rel="apple-touch-icon" sizes="167x167" href="/icon-167x167.png?v=3">
    <link rel="apple-touch-icon" sizes="152x152" href="/icon-152x152.png?v=3">
    <link rel="icon" type="image/png" sizes="32x32" href="/icon-32x32.png?v=3">
    <link rel="icon" type="image/png" sizes="16x16" href="/icon-16x16.png?v=3">
    
    <link rel="stylesheet" href="styles.css">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <!-- Librerías para generar PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <div class="container">
        <div id="userInfo" class="user-info">
            <!-- Se llenará dinámicamente con auth.js -->
        </div>
        
        <!-- Botón flotante para crear cliente (solo cuando estés logueado) -->
        <div id="botonCrearClienteFlotante" class="boton-flotante oculto">
            <button class="btn-flotante" title="Nuevo Cliente">
                ➕
            </button>
        </div>
        
        <div class="main-header">
            <h1>MAIKA PORCUNA</h1>
            <h2 class="subtitle-header">NUTRICIÓN/DIETÉTICA/SUPLEMENTACIÓN/NUTRICIÓN DEPORTIVA</h2>
            <h3 class="plan-title">PLAN DE ALIMENTACIÓN PERSONALIZADA</h3>
        </div>
        
        <div class="form-container">
            <form id="dietForm">
                <h2>Datos Personales</h2>
                
                <div class="form-group">
                    <label for="nombre">Nombre completo:</label>
                    <input type="text" id="nombre" name="nombre" title="Ingresa el nombre completo del cliente" placeholder="Ej: Juan Pérez" required>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="fechaRegistro">Fecha de registro:</label>
                        <input type="date" id="fechaRegistro" name="fechaRegistro" title="Fecha de registro del cliente" required>
                    </div>

                    <div class="form-group">
                        <label for="sexo">Sexo:</label>
                        <select id="sexo" name="sexo" title="Sexo del cliente" required>
                            <option value="">Selecciona...</option>
                            <option value="Mujer">Mujer</option>
                            <option value="Hombre">Hombre</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="edad">Edad:</label>
                        <input type="number" id="edad" name="edad" title="Edad del cliente en años" placeholder="18-100" required min="18" max="100">
                    </div>

                    <div class="form-group">
                        <label for="altura">Altura (cm):</label>
                        <input type="number" id="altura" name="altura" title="Altura en centímetros" placeholder="140-220" required min="140" max="220">
                    </div>

                    <div class="form-group">
                        <label for="peso">Peso (kg):</label>
                        <input type="number" id="peso" name="peso" title="Peso en kilogramos" placeholder="40.0-200.0" required min="40" max="200" step="0.1">
                    </div>
                </div>

                <div class="form-group">
                    <label for="tipoPersona">Tipo de persona:</label>
                    <select id="tipoPersona" name="tipoPersona" title="Selecciona el nivel de actividad física" required>
                        <option value="">Selecciona...</option>
                        <option value="sedentaria">Sedentaria</option>
                        <option value="activa">Activa</option>
                        <option value="muy-activa">Muy activa</option>
                    </select>
                </div>

                <h2>Macronutrientes (Auto-calculados)</h2>

                <div class="macro-info">
                    <div class="macro-item">
                        <label for="calorias">Calorías diarias:</label>
                        <input type="number" id="calorias" name="calorias" title="Calorías diarias calculadas automáticamente" placeholder="Auto-calculado" readonly>
                    </div>
                    <div class="macro-item">
                        <label for="proteinas">Proteínas (g):</label>
                        <input type="number" id="proteinas" name="proteinas" title="Gramos de proteínas calculados automáticamente" placeholder="Auto-calculado" readonly>
                    </div>
                    <div class="macro-item">
                        <label for="grasas">Grasas (g):</label>
                        <input type="number" id="grasas" name="grasas" title="Gramos de grasas calculados automáticamente" placeholder="Auto-calculado" readonly>
                    </div>
                    <div class="macro-item">
                        <label for="carbohidratos">Carbohidratos (g):</label>
                        <input type="number" id="carbohidratos" name="carbohidratos" title="Gramos de carbohidratos calculados automáticamente" placeholder="Auto-calculado" readonly>
                    </div>
                </div>

                <h2>Objetivo</h2>

                <div class="form-group">
                    <label for="objetivo">
                        Selecciona tu objetivo:
                        <span class="tooltip-icon" data-tooltip="El objetivo determina la distribución de calorías y macronutrientes. Aumentar: superávit calórico, Perder: déficit calórico, Mantener: equilibrio energético.">ℹ️</span>
                    </label>
                    <select id="objetivo" name="objetivo" title="Selecciona el objetivo de la dieta" required>
                        <option value="">Selecciona...</option>
                        <option value="aumentar">Aumentar masa muscular</option>
                        <option value="adelgazar">Perder peso</option>
                        <option value="mantener">Mantener peso</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="modoGeneracion">
                        Modo de generación del plan:
                        <span class="tooltip-icon" data-tooltip="Automático: el sistema genera el plan completo. Manual: tú introduces cada alimento y cantidad.">ℹ️</span>
                    </label>
                    <select id="modoGeneracion" name="modoGeneracion" title="Selecciona el modo de generación del plan" required>
                        <option value="automatico">Generación Automática</option>
                        <option value="manual">Generación Manual (Editable)</option>
                    </select>
                </div>

                <h2>Prohibiciones y Alergias</h2>

                <div class="form-group">
                    <label>Selecciona intolerancias comunes (opcional):</label>
                    <div class="checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" name="intolerancia" value="lactosa" id="intol-lactosa" title="Marcar si tienes intolerancia a la lactosa">
                            <span>Lactosa</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="intolerancia" value="gluten" id="intol-gluten" title="Marcar si tienes intolerancia al gluten">
                            <span>Gluten</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="intolerancia" value="frutos-secos" id="intol-frutos-secos" title="Marcar si tienes alergia a los frutos secos">
                            <span>Frutos Secos</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="intolerancia" value="huevo" id="intol-huevo" title="Marcar si tienes alergia al huevo">
                            <span>Huevo</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="intolerancia" value="pescado" id="intol-pescado" title="Marcar si tienes alergia al pescado">
                            <span>Pescado</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="intolerancia" value="mariscos" id="intol-mariscos" title="Marcar si tienes alergia a los mariscos">
                            <span>Mariscos</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="intolerancia" value="soja" id="intol-soja" title="Marcar si tienes alergia a la soja">
                            <span>Soja</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="intolerancia" value="cacahuetes" id="intol-cacahuetes" title="Marcar si tienes alergia a los cacahuetes">
                            <span>Cacahuetes</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="intolerancia" value="carne-roja" id="intol-carne-roja" title="Marcar si no puedes consumir carne roja">
                            <span>Carne Roja</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="intolerancia" value="cerdo" id="intol-cerdo" title="Marcar si no puedes consumir cerdo">
                            <span>Cerdo</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="intolerancia" value="azufre" id="intol-azufre" title="Marcar si tienes intolerancia a los sulfitos">
                            <span>Sulfitos</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="intolerancia" value="levadura" id="intol-levadura" title="Marcar si tienes intolerancia a la levadura">
                            <span>Levadura</span>
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label>Preferencias dietéticas (opcional):</label>
                    <div class="checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" name="preferencia" value="vegetariano" id="pref-vegetariano" title="Marcar si sigues una dieta vegetariana">
                            <span>Vegetariano</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="preferencia" value="vegano" id="pref-vegano" title="Marcar si sigues una dieta vegana">
                            <span>Vegano</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="preferencia" value="pescetariano" id="pref-pescetariano" title="Marcar si sigues una dieta pescetariana">
                            <span>Pescetariano</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="preferencia" value="bajo-carbohidratos" id="pref-bajo-carbs" title="Marcar si prefieres una dieta baja en carbohidratos">
                            <span>Bajo en Carbohidratos</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="preferencia" value="cetogenica" id="pref-keto" title="Marcar si sigues una dieta cetogénica">
                            <span>Cetogénica</span>
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label for="prohibiciones">Indica otros alimentos prohibidos o alergias (opcional):</label>
                    <textarea id="prohibiciones" name="prohibiciones" rows="3" title="Lista adicional de alimentos prohibidos o alergias" placeholder="Ej: Cebolla, cilantro, champiñones..."></textarea>
                </div>

                <div class="form-group">
                    <label for="duracion">Duración del plan:</label>
                    <select id="duracion" name="duracion" title="Selecciona la duración del plan de alimentación" required>
                        <option value="semana">1 Semana</option>
                        <option value="2semanas">2 Semanas</option>
                        <option value="3semanas">3 Semanas</option>
                        <option value="mes">1 Mes (4 Semanas)</option>
                    </select>
                </div>

                <h2>Hidratación</h2>

                <div class="form-group">
                    <label for="hidratacion">Consumo actual de agua (litros/día):</label>
                    <input type="number" id="hidratacion" name="hidratacion" min="0" max="10" step="0.5" value="2" title="Indica cuántos litros de agua bebes al día">
                    <small class="form-help">Recomendación general: 2-3 litros/día. Se calculará una recomendación personalizada según tu peso y actividad.</small>
                </div>

                <button type="submit" class="btn-submit" title="Generar plan de alimentación personalizado">✨ Generar Plan de Alimentación</button>
            </form>
        </div>

        <div id="resultados" class="resultados oculto">
            <div class="print-header">
                <div class="btn-container">
                    <button type="button" id="btnGuardar" class="btn-save" title="Guardar dieta en Firebase">
                        💾 Guardar Dieta
                    </button>
                    <button type="button" id="btnEditarDieta" class="btn-edit" title="Editar la dieta antes de descargar">
                        ✏️ Editar Dieta
                    </button>
                    <button type="button" id="btnDescargar" class="btn-download" title="Descargar plan en formato PDF">
                        📥 Descargar Plan en PDF
                    </button>
                    <button type="button" id="btnNuevo" class="btn-new" title="Crear una nueva dieta">
                        🔄 Nueva Dieta
                    </button>
                </div>
            </div>

            <!-- Contenido que se exportará a PDF -->
            <div id="pdf-content">
                <div class="pdf-header">
                    <h1>MAIKA PORCUNA</h1>
                    <h2 class="subtitle">NUTRICIÓN/DIETÉTICA/SUPLEMENTACIÓN/NUTRICIÓN DEPORTIVA</h2>
                    <h3 class="plan-subtitle">PLAN DE ALIMENTACIÓN PERSONALIZADA</h3>
                    <div class="nutricionista-contacto-header">
                        <p class="contacto-item-header">
                            <span class="contacto-icon-header">📧</span>
                            <a href="mailto:Maikafit1977@gmail.com" style="color: inherit; text-decoration: none;">Maikafit1977@gmail.com</a>
                        </p>
                        <p class="contacto-item-header">
                            <span class="contacto-icon-header">📞</span>
                            <a href="tel:+34650229987" style="color: inherit; text-decoration: none;">+34 650 229 987</a>
                        </p>
                    </div>
                </div>

                <div class="tabs">
                    <button class="tab active" data-tab="dieta" title="Ver plan de comidas semanal">DIETA</button>
                    <button class="tab" data-tab="alimentos" title="Ver lista de alimentos recomendados">ALIMENTOS</button>
                    <button class="tab" data-tab="revisiones" title="Ver revisiones y seguimiento">REVISIONES</button>
                    <button class="tab" data-tab="calendario" title="Ver calendario de comidas">CALENDARIO</button>
                    <button class="tab" data-tab="prohibiciones" title="Ver alimentos prohibidos y alergias">PROHIBICIONES</button>
                </div>

                <div id="tab-dieta" class="tab-content active">
                    <!-- Tabla de Macronutrientes -->
                    <div class="macro-table">
                        <h3>Macronutrientes</h3>
                        <table class="tabla-macros">
                            <thead>
                                <tr>
                                    <th>NUTRIENTE</th>
                                    <th>AUTOMÁTICO</th>
                                    <th>AJUSTE MANUAL</th>
                                    <th>SELECCIONADO</th>
                                    <th>% CALORÍAS</th>
                                    <th>CONSUMIDO</th>
                                    <th>ESTADO</th>
                                </tr>
                            </thead>
                            <tbody id="tabla-macros-body">
                                <!-- Se llenará con JS -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Calculadora TMB -->
                    <div id="tmb-calculator"></div>

                    <!-- Información del Usuario -->
                    <div class="info-usuario-table">
                        <h3>Información del Usuario</h3>
                        <table class="tabla-info">
                            <thead>
                                <tr>
                                    <th>Nombre</th>
                                    <th>Fecha registro</th>
                                    <th>Sexo</th>
                                    <th>Edad</th>
                                    <th>Peso (kg)</th>
                                    <th>Altura (cm)</th>
                                    <th>Tipo persona</th>
                                    <th>IMC</th>
                                </tr>
                            </thead>
                            <tbody id="tabla-info-body">
                                <!-- Se llenará con JS -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Plan de Alimentación Semanal -->
                    <div id="plan-alimentacion" class="plan-alimentacion">
                        <!-- Se llenará con JS -->
                    </div>

                    <!-- Nota sobre agua (solo una vez) -->
                    <div id="nota-agua" class="notas-agua-section" style="margin-top: 30px; padding: 15px; background: #d1ecf1; border-radius: 8px; border-left: 4px solid #17a2b8;">
                        <h4 style="color: #0c5460; margin-bottom: 10px;">📝 NOTA IMPORTANTE</h4>
                        <p style="margin: 0; color: #0c5460;">Recuerda beber al menos 2-3 litros de agua al día. Ajusta las porciones según tu nivel de saciedad y energía.</p>
                    </div>
                </div>

                <div id="tab-alimentos" class="tab-content">
                    <h2>Lista de Alimentos Recomendados</h2>
                    <div class="alimentos-info">
                        <h3>Proteínas</h3>
                        <p>Pollo, pavo, pescado, huevos, carne magra, tofu, legumbres, lácteos bajos en grasa.</p>
                        
                        <h3>Carbohidratos</h3>
                        <p>Arroz integral, avena, quinoa, batata, patatas, pasta integral, pan integral, frutas.</p>
                        
                        <h3>Grasas Saludables</h3>
                        <p>Aceite de oliva, aguacate, frutos secos, semillas, pescado azul, mantequilla de cacahuete.</p>
                        
                        <h3>Verduras y Hortalizas</h3>
                        <p>Brócoli, espinacas, lechuga, tomate, pepino, zanahoria, calabacín, pimientos, espárragos.</p>
                    </div>
                </div>

                <div id="tab-revisiones" class="tab-content">
                    <h2>Revisiones y Seguimiento</h2>
                    <div class="revisiones-info">
                        <h3>Recomendaciones de seguimiento</h3>
                        <ul>
                            <li>Pesarse una vez por semana, siempre a la misma hora</li>
                            <li>Tomar medidas corporales cada 2 semanas</li>
                            <li>Hacer fotos de progreso mensualmente</li>
                            <li>Revisar sensaciones de energía y saciedad diariamente</li>
                            <li>Ajustar calorías según resultados cada 3-4 semanas</li>
                        </ul>
                    </div>
                </div>

                <div id="tab-calendario" class="tab-content">
                    <h2>Calendario de Comidas</h2>
                    <div class="calendario-info">
                        <h3>Horarios recomendados</h3>
                        <table class="tabla-horarios">
                            <tr>
                                <th>Comida</th>
                                <th>Horario sugerido</th>
                            </tr>
                            <tr>
                                <td>🍳 Desayuno</td>
                                <td>7:00 - 9:00</td>
                            </tr>
                            <tr>
                                <td>🥤 Mediodía</td>
                                <td>10:30 - 11:30</td>
                            </tr>
                            <tr>
                                <td>🍽️ Comida</td>
                                <td>13:00 - 15:00</td>
                            </tr>
                            <tr>
                                <td>🥙 Merienda</td>
                                <td>17:00 - 18:00</td>
                            </tr>
                            <tr>
                                <td>🌙 Cena</td>
                                <td>20:00 - 22:00</td>
                            </tr>
                        </table>
                    </div>
                </div>

                <div id="tab-prohibiciones" class="tab-content">
                    <h2>Prohibiciones y Alergias</h2>
                    <div id="prohibiciones-info" class="prohibiciones-info">
                        <!-- Se llenará con JS -->
                    </div>
                </div>

                <div class="pdf-footer">
                    <p>© 2025 Maika Porcuna - Nutrición/Dietética/Suplementación Plan generado el <span id="fecha-generacion"></span></p>
                    <p style="margin: 10px 0;">Este plan es personalizado y confidencial</p>
                    <div class="pdf-footer-contacto">
                        <p class="contacto-item">
                            <span class="contacto-icon">📞</span> 
                            <a href="tel:+34650229987" style="color: inherit; text-decoration: none;">+34 650 229 987</a>
                        </p>
                        <p class="contacto-item">
                            <span class="contacto-icon">📧</span> 
                            <a href="mailto:Maikafit1977@gmail.com" style="color: inherit; text-decoration: none;">Maikafit1977@gmail.com</a>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts en orden de dependencia -->
    <script src="firebase-config.js"></script>
    <script src="auth.js"></script>
    <script src="dietaService.js"></script>
    <script src="clienteService.js"></script>
    <script src="base-datos-alimentos.js"></script>
    <script src="generador-dietas.js"></script>
    <!-- editor-dietas.js REMOVIDO: Sistema antiguo reemplazado por tabla-editable.js -->
    <script src="verificar-firestore.js"></script>
    <script src="cliente-manager.js"></script>
    <script src="tabla-editable.js"></script>
    <script src="diagnostico-tabla-editable.js"></script>
    <script src="ui-manager.js"></script>
    <script src="script.js"></script>
    
    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then((registration) => {
                        console.log('✅ Service Worker registrado exitosamente:', registration.scope);
                    })
                    .catch((error) => {
                        console.error('❌ Error al registrar Service Worker:', error);
                    });
            });
        }
    </script>
</body>
</html>
